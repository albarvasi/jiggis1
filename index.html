<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Date Time ðŸ’–</title>
  <style>
    :root{
      --bg:#fff5f7; --fg:#351431; --pink:#ff4d6d; --pink-2:#ffa6b6; --card:#fff;
      --shadow:0 10px 30px rgba(0,0,0,.10);
    }
    *{box-sizing:border-box}
    body{
      margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;
      color:var(--fg);
      background:
        radial-gradient(1200px 600px at 80% -100px,#ffd6de 0,transparent 70%),
        radial-gradient(1200px 600px at 0% 120%,#ffe3e9 0,transparent 70%),
        var(--bg);
      display:grid; place-items:center; padding:24px; min-height:100dvh;
      overflow-x:hidden;
    }
    .card{
      width:min(720px,92vw); background:var(--card); border-radius:24px;
      box-shadow:var(--shadow); padding:clamp(20px,5vw,36px); text-align:center;
      position:relative; z-index:2;
    }
    h1{font-size:clamp(28px,3.6vw,42px); margin:6px 0 10px;}
    .btns{position:relative; display:flex; justify-content:center; gap:16px; flex-wrap:wrap; min-height:64px; margin-top:16px;}
    button{border:none; border-radius:999px; padding:14px 22px; font-size:18px; font-weight:700; cursor:pointer;}
    .yes{background:var(--pink); color:#fff; box-shadow:0 8px 18px rgba(255,77,109,.25);}
    .no{background:#f1eef1; color:#5a3a53; position:absolute;}

    /* small sound toggle */
    .sound-toggle{
      position:fixed; top:12px; right:12px; z-index:4;
      background:white; border-radius:999px; padding:8px 12px; box-shadow:var(--shadow);
      font-weight:700; font-size:14px; cursor:pointer; border:0;
    }

    /* Overlay */
    .overlay{position:fixed; inset:0; display:grid; place-items:center; background:rgba(255,245,247,.7); backdrop-filter:blur(2px); z-index:3;}
    .hidden{display:none!important}
    .dialog{background:#fff; border-radius:20px; padding:26px; width:min(620px,92vw); text-align:center; box-shadow:var(--shadow); animation:pop .35s ease;}
    @keyframes pop{from{transform:scale(.92); opacity:.2} to{transform:scale(1); opacity:1}}

    /* Roses: bloom + gentle float */
    .celebration-img{opacity:0; transform:scale(.94) translateY(6px); filter:blur(2px);}
    .celebration-img.is-visible{
      animation:roseIn .7s ease forwards, gentleFloat 6s ease-in-out 1s infinite alternate;
    }
    @keyframes roseIn{from{opacity:0; transform:scale(.94) translateY(6px); filter:blur(2px);} to{opacity:1; transform:scale(1) translateY(0); filter:blur(0);}}
    @keyframes gentleFloat{from{transform:translateY(0) scale(1);} to{transform:translateY(-6px) scale(1.01);}}

    /* Dreamy sparkle */
    .celebration-img-wrapper{
      position:relative; display:inline-block; overflow:hidden; border-radius:16px; box-shadow:0 6px 16px rgba(0,0,0,.15);
    }
    .celebration-img-wrapper::after{
      content:""; position:absolute; top:0; left:-75%; width:50%; height:100%;
      background:linear-gradient(120deg,rgba(255,255,255,0) 0%, rgba(255,255,255,.45) 50%, rgba(255,255,255,0) 100%);
      transform:skewX(-20deg); opacity:0; pointer-events:none;
    }
    .celebration-img-wrapper.sparkle::after{
      animation:shimmerCycle 12s ease-in-out infinite;
    }
    @keyframes shimmerCycle{
      0%   { left:-75%; opacity:0; }
      2%   { opacity:1; }
      20%  { left:125%; opacity:0; }
      100% { left:125%; opacity:0; }
    }

    /* Runner */
    #runner{
      position:fixed; bottom:14px; left:-20vw;
      width:clamp(64px, 10vw, 120px); height:auto;
      z-index:1; pointer-events:none;
      animation:runAcross 14s linear infinite;
      filter:drop-shadow(0 4px 8px rgba(0,0,0,.25));
    }
    #runner .sprite{ width:100%; height:auto; display:block; transition:filter .2s ease; }

    /* Singing state */
    #runner.singing{ animation-play-state:paused; }
    #runner.singing .sprite{
      animation:singPulse .9s ease-in-out infinite alternate;
      filter:drop-shadow(0 6px 14px rgba(255,145,196,.65)) saturate(1.15) brightness(1.05);
    }
    @keyframes singPulse{ from{transform:scale(1);} to{transform:scale(1.09) translateY(-2px);} }

    /* Musical notes */
    #runner::before, #runner::after{
      content:"â™ª"; position:absolute; right:10%; bottom:70%;
      font-size:clamp(16px, 2.4vw, 24px); opacity:0; pointer-events:none;
    }
    #runner::after{ content:"â™«"; right:auto; left:10%; bottom:66%; }
    #runner.singing::before{ animation:noteRise 1.1s ease-out infinite; }
    #runner.singing::after{ animation:noteRise 1.1s ease-out infinite .25s; }
    @keyframes noteRise{
      0%{ transform:translateY(0) translateX(0) rotate(0); opacity:0; }
      10%{ opacity:1; }
      100%{ transform:translateY(-26px) translateX(-8px) rotate(-10deg); opacity:0; }
    }

    @keyframes runAcross{
      0%   { transform:translateX(0) translateY(0) scale(1); opacity:0; }
      5%   { opacity:1; }
      50%  { transform:translateX(60vw) translateY(-2px) scale(1.02); }
      100% { transform:translateX(120vw) translateY(0) scale(1); opacity:0; }
    }

    /* Reduced motion = fewer effects + start muted by default */
    @media (prefers-reduced-motion: reduce){
      .celebration-img.is-visible{ animation:none; opacity:1; transform:none; filter:none; }
      .celebration-img-wrapper::after{ animation:none !important; opacity:0 !important; }
      #runner{ animation:none; left:auto; right:14px; bottom:14px; }
      #runner .sprite{ animation:none !important; }
      #runner::before, #runner::after{ display:none !important; }
    }
  </style>
</head>
<body>
  <!-- sound toggle -->
  <button class="sound-toggle" id="soundToggle" aria-pressed="false" title="Toggle sound">ðŸ”‡ Sound</button>

  <main class="card">
    <h1>I would like to take you out on a date?!</h1>
    <div class="btns">
      <button class="yes" id="yesBtn">Yes ðŸ’—</button>
      <button class="no" id="noBtn">No ðŸ™ˆ</button>
    </div>
  </main>

  <!-- Jigglypuff -->
  <div id="runner" aria-hidden="true">
    <img class="sprite" src="jigglypuff.gif" alt="" />
  </div>

  <!-- Success overlay -->
  <section id="overlay" class="overlay hidden" aria-live="polite">
    <div class="dialog">
      <h2 style="margin:0 0 8px;font-size:32px;">She said YES! ðŸŽ‰</h2>
      <p style="margin:0 0 12px;font-size:18px;">You just made me the happiest person today! ðŸ’–</p>
      <div id="rosesWrapper" class="celebration-img-wrapper">
        <img id="rosesImg" class="celebration-img" src="IMG_0425.jpeg"
             alt="A bouquet of red roses" style="max-width:100%;display:block;" />
      </div>
    </div>
  </section>

  <script>
    const yesBtn = document.getElementById('yesBtn');
    const noBtn  = document.getElementById('noBtn');
    const overlay= document.getElementById('overlay');
    const btnsContainer = document.querySelector('.btns');

    // --- No button antics ---
    function moveNoButton(){
      const maxX = btnsContainer.clientWidth - noBtn.offsetWidth - 12;
      const maxY = Math.max(btnsContainer.clientHeight, 80) - noBtn.offsetHeight - 12;
      const x = Math.random()*maxX, y = Math.random()*maxY;
      noBtn.style.left = x+'px'; noBtn.style.top = y+'px';
    }
    noBtn.addEventListener('pointerenter', moveNoButton);
    noBtn.addEventListener('pointerdown', (e)=>{ e.preventDefault(); moveNoButton(); });

    // --- Roses overlay ---
    function handleYes(){
      overlay.classList.remove('hidden');
      const img = document.getElementById('rosesImg');
      const wrapper = document.getElementById('rosesWrapper');
      const showImg = () => {
        img.classList.add('is-visible');
        setTimeout(()=> wrapper.classList.add('sparkle'), 800);
      };
      if (img.complete) { requestAnimationFrame(showImg); }
      else { img.addEventListener('load', showImg, { once:true }); }
    }
    yesBtn.addEventListener('click', handleYes);

    // --- Web Audio: gentle chime on "sing" ---
    let audioCtx = null;
    let audioEnabled = false;
    const prefersReducedMotion = window.matchMedia?.('(prefers-reduced-motion: reduce)')?.matches ?? false;

    // create or resume audio on first user gesture
    function unlockAudio(){
      if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
      if (audioCtx.state === 'suspended') audioCtx.resume();
      // if user prefers reduced motion, start muted unless they explicitly enable
      if (!prefersReducedMotion) audioEnabled = true;
      updateSoundToggle();
      window.removeEventListener('pointerdown', unlockAudio);
      window.removeEventListener('keydown', unlockAudio);
    }
    window.addEventListener('pointerdown', unlockAudio, { once:false });
    window.addEventListener('keydown', unlockAudio, { once:false });

    function playChime(){
      if (!audioCtx || !audioEnabled) return;

      const now = audioCtx.currentTime;
      const master = audioCtx.createGain();
      master.gain.value = 0.12; // overall softness
      master.connect(audioCtx.destination);

      // tiny reverb-ish tail via delay + feedback
      const delay = audioCtx.createDelay(0.5);
      const fb = audioCtx.createGain();
      delay.delayTime.value = 0.18;
      fb.gain.value = 0.25;
      delay.connect(fb).connect(delay);
      delay.connect(master);

      // notes (a cute little up arpeggio)
      const notes = [880, 1175, 1318]; // A5, D6, E6-ish
      const gap = 0.12;

      notes.forEach((freq, i)=>{
        const t = now + i * gap;
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();

        osc.type = 'triangle';
        osc.frequency.setValueAtTime(freq, t);

        // soft attack/decay envelope
        gain.gain.setValueAtTime(0.0001, t);
        gain.gain.exponentialRampToValueAtTime(0.22, t + 0.03);
        gain.gain.exponentialRampToValueAtTime(0.0001, t + 0.35);

        // subtle vibrato for cuteness
        const lfo = audioCtx.createOscillator();
        const lfoGain = audioCtx.createGain();
        lfo.type = 'sine';
        lfo.frequency.value = 5.5;
        lfoGain.gain.value = 6; // +/- Hz
        lfo.connect(lfoGain).connect(osc.frequency);

        // route
        osc.connect(gain);
        gain.connect(master);
        gain.connect(delay);

        // schedule
        osc.start(t);
        lfo.start(t);
        osc.stop(t + 0.5);
        lfo.stop(t + 0.5);
      });
    }

    // sound toggle UI
    const soundToggle = document.getElementById('soundToggle');
    function updateSoundToggle(){
      soundToggle.setAttribute('aria-pressed', audioEnabled ? 'true' : 'false');
      soundToggle.textContent = audioEnabled ? 'ðŸ”Š Sound' : 'ðŸ”‡ Sound';
    }
    soundToggle.addEventListener('click', ()=>{
      if (!audioCtx) unlockAudio();
      audioEnabled = !audioEnabled;
      updateSoundToggle();
    });
    // initial label respects reduced motion (muted by default)
    updateSoundToggle();

    // --- Runner singing logic ---
    const runner = document.getElementById('runner');
    let isSinging = false;

    function startSinging(durationMs=1600){
      if (isSinging) return;
      isSinging = true;
      runner.classList.add('singing');
      playChime(); // gentle chime when singing starts

      setTimeout(()=>{
        runner.classList.remove('singing');
        isSinging = false;
      }, durationMs);
    }

    // Occasionally trigger singing
    const interval = setInterval(()=>{
      const opacity = parseFloat(getComputedStyle(runner).opacity || "1");
      if (opacity > 0.1 && Math.random() < 0.35) {
        startSinging(1500 + Math.random()*700);
      }
    }, 3500);

    runner.addEventListener('animationiteration', ()=>{
      if (Math.random() < 0.25) startSinging(1300);
    });
  </script>
</body>
</html>